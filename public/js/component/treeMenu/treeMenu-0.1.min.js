var TREEMENU=angular.module("TREEMENULIB",["ngAnimate"],["$interpolateProvider",function(a){a.startSymbol("--__");a.endSymbol("__--")}]);TREEMENU.directive("treeMenu",["$timeout",function(b){var a="0.1";return{restrict:"E",templateUrl:function(){var c=document.URL;c=c.split("public");return c[0]+"public/js/component/treeMenu/treeMenu-"+a+".html"},replace:true,scope:{treeMenuData:"=data",globalSelectionCallback:"&",initialSelection:"@",navigator:"=",selectedNodeConnector:"="},link:function(n,i,m){n.randomString=function(r){var s="";var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var q=0;q<r;q++){s+=p.charAt(Math.floor(Math.random()*p.length))}return s};var j,c;var l=null;var g=function(q,p){if(p){console.log("TREE MENU, ERROR: ",q);return void (0)}else{console.log("TREE MENU: ",q)}};if(m.iconExpand===null){m.iconExpand="icon-plus  glyphicon glyphicon-plus fa fa-plus"}if(m.iconCollapse===null){m.iconCollapse="icon-minus glyphicon glyphicon-minus fa fa-minus"}if(m.iconLeaf===null){m.iconLeaf="icon-file  glyphicon glyphicon-file  fa fa-file"}if(m.initialExpand===null){m.initialExpand="3"}j=parseInt(m.initialExpand,1);if(!n.treeMenuData){g("Albero vuoto");return}if(n.treeMenuData.length===null){if(n.treeMenuData.label!==null){n.treeMenuData=[n.treeMenuData]}else{g("I dati che alimentano l'albero non sono scritti nel modo corretto")}}var h=function(t,p){var s=function(x,z){var w=[];w.push(t(x,z));if(x.children!==null){for(var v=0;v<x.children.length;v++){var y=x.children[v];var u=s(y,z+1);w.push(u)}}return w};var r=[];if(typeof(p)==="undefined"){for(var q=0;q<n.treeMenuData.length;q++){r.push(s(n.treeMenuData[q],1))}}else{if(p&&p.children){for(var q=0;q<p.children.length;q++){r.push(s(p.children[q],p.level+1))}}}return r};n.globalSelectionCallback=function(p){if(!angular.isObject(p)){g("Questa non è una selezione valida",true);return}if(typeof(p.node)!=="undefined"){var q=p.node}};var f=function(p){if(!p){if(l!==null){l.selected=false}l=null;n.selectedNodeConnector={label:null};return}if(p!==l){if(l!==null){l.selected=false}p.selected=true;n.selectedNodeConnector=p;l=p;k(p);if(p.selectionCallback!==null){return b(function(){return p.selectionCallback(p)},100)}else{if(n.globalSelectionCallback==="true"){return b(function(){return n.globalSelectionCallback({node:p})})}}}else{l.selected=false;n.selectedNodeConnector={label:null};l=null}};n.clickOnNode=function(p){return f(p)};var o=function(q){var p;p=null;if(q.parentId){h(function(r){if(r.id===q.parentId){return p=r}})}return p};var e=function(q,r){var p;p=o(q);if(p!==null){r(p);return e(p,r)}};var k=function(p){return e(p,function(r){try{return n.expandNode(r,true)}catch(q){g(q,true);g(r,true)}})};n.treeRows=[];var d=function(){var t=h(function(x,v){var u=n.randomString(10);if(typeof(x)==="string"){g("TROVATO NODO STRINGA -- qualcosa è andato storto",true);return x}if(!x.id){x.id=u;if(x.children&&x.children.length){for(var w in x.children){if(typeof(x.children[w])==="string"){x.children[w]={label:x.children[w]}}}}return x}});h(function(x){if(angular.isArray(x.children)){var v=[];for(var u in x.children){var w=x.children[u];v.push(w.parentId=x.id)}return v}});n.treeRows=[];h(function(u){if(u.children&&u.children.length>0){var v=function(w){if(typeof(w)==="string"){return{label:w,children:[]}}else{return w}};return u.children=(function(){var x=[];for(var w in u.children){var y=u.children[w];x.push(v(y))}return x})()}else{return u.children=[]}});h(function(w,u){try{w.level=u}catch(v){g(v,true);g(w,true);g(u,true)}return w.expanded=w.level<j});if(n.initialSelectionId!==null){h(function(u){if(u.id===n.initialSelectionId){b(function(){k(u);return f(u)},100);return true}else{return false}})}else{if(m.initialSelection!==null){h(function(u){if(u.label===m.initialSelection){b(function(){k(u);return f(u)},100);return true}return false})}}var q=function(B,x,z){var u;if(x.expanded===null){x.expanded=false}if(!x.children||!x.children.length){u=m.iconLeaf}else{if(x.expanded){u=m.iconCollapse}else{u=m.iconExpand}}n.treeRows.push({level:B,node:x,label:x.label,tree_icon:u,visible:z});if(x.children!==null){var w=[];for(var v in x.children){var A=x.children[v];var y=z&&x.expanded;w.push(q(B+1,A,y))}return w}};var s=[];for(var r in n.treeMenuData){var p=n.treeMenuData[r];s.push(q(1,p,true))}return s};n.$watch("treeMenuData",d);n.treeRowsSearchNode=function(q){for(var p in n.treeRows){if(q.id===n.treeRows[p].node.id){return p}}return -1};n.expandNode=function(r,s){if(s===false||(typeof(s)==="undefined"&&r.expanded)){r.expanded=false;h(function(v,t){var u=n.treeRowsSearchNode(v);if(u!==-1){n.treeRows[u].visible=false;n.treeRows[u].tree_icon=(v.children.length?m.iconExpand:m.iconLeaf)}v.expanded=false},r)}else{if(s===true||(typeof(s)==="undefined"&&!r.expanded)){r.expanded=true;for(var q in r.children){var p=n.treeRowsSearchNode(r.children[q]);if(p!==-1){n.treeRows[p].visible=true}}}}var p=n.treeRowsSearchNode(r);if(r.expanded){n.treeRows[p].visible=true;n.treeRows[p].tree_icon=(r.children.length?m.iconCollapse:m.iconLeaf)}else{n.treeRows[p].tree_icon=(r.children.length?m.iconExpand:m.iconLeaf)}};if(n.navigator&&angular.isObject(n.navigator)){c=n.navigator;c.expandAll=function(){h(function(q,p){n.expandNode(q,true)})};c.collapseAll=function(){return h(function(q,p){n.expandNode(q,false)})};c.getFirstNode=function(){var p=n.treeMenuData.length;if(p>0){return n.treeMenuData[0]}};c.selectFirstNode=function(){var p=c.getFirstNode();return c.selectNode(p)};c.getSelectedNode=function(){return l};c.getParentNode=function(p){return o(p)};c.selectNode=function(p){f(p);return p};c.getChildrenNodes=function(p){return p.children};c.selectParentNode=function(r){var q;if(r===null){r=c.getSelectedNode()}if(r!==null){q=c.getParentNode(r);if(q!==null){c.selectNode(q);return q}}};c.addNode=function(p,r){if(!r){r={label:"nuovo nodo"}}var q=n.randomString(10);r.id=q;r.unconfirmed=true;if(p!==null){if(p.level>=10){g("Questa componente supporta al massimo 10 livelli.",true);return}p.children.push(r);n.expandNode(p,true);l.selected=false;l=null}else{n.treeMenuData.push(r)}var s=angular.copy(n.treeMenuData);n.treeMenuData=[];n.initialSelectionId=q;b(function(){n.treeMenuData=s},100)};c.removeNode=function(s){if(!s){s=l}if(!s){return}var p=o(s);if(p!==null){for(var q in p.children){if(p.children[q].id===s.id){p.children.splice(q,1)}}s.selected=false;l=null;s=null}else{for(var q in n.treeMenuData){if(n.treeMenuData[q].id===s.id){n.treeMenuData.splice(q,1)}}l.selected=false;l=null;s=null}var r=angular.copy(n.treeMenuData);n.treeMenuData=[];b(function(){n.treeMenuData=r},100)};c.toggleExpandNode=function(p){if(p===null){p=c.getSelectedNode()}if(p!==null){n.expandNode(p);return p}};c.getSiblingNodes=function(s){if(s===null){s=l}if(s!==null){var q=c.getParentNode(s);var r;if(q){r=q.children}else{r=n.treeMenuData}return r}};c.getNextSiblingNode=function(r){if(r===null){r=l}if(r!==null){var q=c.getSiblingNodes(r);r=q.length;var p=q.indexOf(r);if(p<r){return q[p+1]}else{return null}}};c.getPreviousSiblingNode=function(r){var p,q;if(r===null){r=l}var q=c.getSiblingNodes(r);r=q.length;var p=q.indexOf(r);if(p>0){return q[p-1]}else{return null}};c.selectNextSiblingNode=function(q){var p;if(q===null){q=l}if(q!==null){p=c.getNextSiblingNode(q);if(p!==null){return c.selectNode(p)}}};c.selectPreviousSiblingNode=function(q){var p;if(q===null){q=l}if(q!==null){p=c.getPreviousSiblingNode(q);if(p!==null){return c.selectNode(p)}}};c.moveNodeUnder=function(t,q){if(!t){t=l}if(!t){return}var s=o(t);if(typeof(q)==="undefined"){if(s&&s.id&&t.parentId&&t.parentId===s.id){var p=s.children.indexOf(t);if(p>-1){s.children.splice(p,1)}}delete (t.parentId);n.treeMenuData.push(t);n.initialSelectionId=t.id;var r=angular.copy(n.treeMenuData);n.treeMenuData=[]}else{if(q.id&&angular.isArray(q.children)){if(s&&s.id&&t.parentId&&t.parentId===s.id){var p=s.children.indexOf(t);if(p>-1){s.children.splice(p,1)}}q.children.push(t);t.parentId=q.id;n.initialSelectionId=t.id;var r=angular.copy(n.treeMenuData);n.treeMenuData=[]}else{g("Impossibile realizzare lo spostamento, under non è un nodo valido",true);var r=n.treeMenuData}}b(function(){n.treeMenuData=r},100);return t};c.showThisNode=function(p){if(!p){p=l}if(!p){return}k(p);if(p!==l){f(p)}};c.updateNodeView=function(q){var p=-1;p=n.treeRowsSearchNode(q);if(p===-1){return}g(n.treeRows[p].node);n.treeRows[p].label=q.label}}else{g("tree navigator non è un oggetto",true)}}}}]);
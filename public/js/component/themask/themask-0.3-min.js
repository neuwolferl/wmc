var app=angular.module("THEMASK",["SMARTBUTTON"],["$interpolateProvider",function(a){a.startSymbol("--__");a.endSymbol("__--")}]);app.directive("maschera",["TheMask","SmartButton",function(c,b){var a="0.3";return{templateUrl:function(){var d=document.URL;d=d.split("public");return d[0]+"public/js/component/themask/themask-"+a+".html"},restrict:"E",transclude:true,replace:true,scope:{title:"@titlep",size:"@sizep",maskId:"=maskid",buttons:"@buttons"},link:function(f,e,d){e.attr("id","myModal"+f.title);var g=function(){var n=e.find(".dimensionatore");if(!n.length){return}var l=n.height();var m=n.offset().top;var o=$(window).height();var k=o-2*m;if(l>k){n.height(k)}else{k=l}var j=n.find(".dimensionatore-head");if(!j.length){return}var i=e.find(".dimensionatore").find(".dimensionatore-tail");if(!i.length){return}j.height("auto");i.height(k-j.height())};e.on("DOMSubtreeModified",g());e.on("DOMNodeInserted",g())},controller:["$scope","$element","$attrs","$rootScope","$timeout","TheMask","SmartButton","$interval",function(m,n,l,k,f,d,e,j){var h=this;m.maskObj=d.getMask(m.maskId).getObj();m.btnClick=function(p){for(var o in m.btns){if(m.btns[o].btn[0]===p){p=o;break}}k.$emit("TheMask said something",{btn:p,maskid:m.maskId});if(typeof(m.maskObj.btnCallBacks[p])!=="undefined"){(m.maskObj.btnCallBacks[p])()}return true};m.btns=m.buttons.split("|");for(var g in m.btns){m.btns[g]={label:m.btns[g],btn:e.newBtn()}}for(var g in m.btns){e.getBtn(m.btns[g].btn[0]).setClickFcn(m.btnClick)}d.getMask(m.maskId).setOpener(function(){n.show(500);m.btnRefresher=j(function(){if(typeof(m.maskObj.btnEnableConditions)!=="undefined"){for(var o in m.btns){if(typeof(m.maskObj.btnEnableConditions[o])==="function"){if((m.maskObj.btnEnableConditions[o])()){m.btns[o].btn[1].enable()}else{m.btns[o].btn[1].disable()}}else{m.btns[o].btn[1].enable()}}}},500)});d.getMask(m.maskId).setCloser(function(){n.hide(500);if(m.btnRefresher){j.cancel(m.btnRefresher)}});m.modalClass=function(){if(typeof(m.size)!=="undefined"){switch(m.size){case"lg":return"modal-dialog modal-lg";break;case"sm":return"modal-dialog modal-sm";break;default:return"modal-dialog";break}}else{return"modal-dialog"}};this.adjust=function(){var s=n.find(".dimensionatore");if(!s.length){return}var q=s.height();var r=s.offset().top;var t=$(window).height();var p=t-2*r;s.height(p);var o=s.find(".dimensionatore-head");if(!o.length){return}var i=n.find(".dimensionatore").find(".dimensionatore-tail");if(!i.length){return}o.height("auto");i.height(p-o.height())};n.on("adjust",function(){h.adjust()});n.find(".dimensionatore").on("DOMSubtreeModified",h.adjust())}]}}]);app.provider("TheMask",function(){this.randomString=function(c){var d="";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var b=0;b<c;b++){d+=a.charAt(Math.floor(Math.random()*a.length))}return d};this.setTicket=function(){var a=true;while(a){var b=this.randomString(10);if(typeof(this.hash[b])==="undefined"){a=false}}this.hash[b]={open:function(){},close:function(){},btnCallBacks:[],btnEnableConditions:[]};return[b,this.hash[b]]};this.lock=false;this.hash=[];this.$get=["$filter","$rootScope","SmartButton",function(d,a,b){var c=this;return{getMask:function(e){return{setOpener:function(f){c.hash[e].open=function(){f()}},setCloser:function(f){c.hash[e].close=function(){f()}},setBtnCallback:function(f,g){if(!c.hash[e].btnCallBacks){c.hash[e].btnCallBacks=[]}c.hash[e].btnCallBacks[f]=function(){g()}},setBtnEnableCondition:function(f,g){if(!c.hash[e].btnCallBacks){c.hash[e].btnEnableConditions=[]}c.hash[e].btnEnableConditions[f]=function(){return g()}},show:function(){c.hash[e].open()},hide:function(){c.hash[e].close()},canShow:function(){},getObj:function(){return c.hash[e]}}},getAll:function(){return c.hash},isDefined:function(e){return(typeof(c.hash[e])!=="undefined")},newMask:function(){return c.setTicket()}}}]});